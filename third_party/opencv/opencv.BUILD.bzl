load("@rules_foreign_cc//foreign_cc:cmake.bzl", "cmake")

filegroup(
    name = "all_srcs",
    srcs = glob(["**"]),
)

cmake(
    name = "opencv",
    lib_source = "//:all_srcs",
    cache_entries = {
        "BUILD_PERF_TESTS": "OFF",
        "BUILD_TESTS": "OFF",
        "BUILD_opencv_java_bindings_generator": "OFF",
        "BUILD_opencv_js": "OFF",
        "BUILD_opencv_js_bindings_generator": "OFF",
        "BUILD_opencv_python_bindings_generator": "OFF",
        "BUILD_opencv_python_tests": "OFF",
        "BUILD_OPENJPEG": "ON",
        "WITH_GTK": "ON",
    },
    generate_args = ["-GNinja"],
    tags = ["requires-network"],
    out_include_dir = "include/opencv4",
    out_shared_libs = select({
        "@bazel_tools//src/conditions:darwin": ["libopencv_calib3d.4.6.0.dylib","libopencv_calib3d.406.dylib","libopencv_calib3d.dylib",
                                "libopencv_core.4.6.0.dylib","libopencv_core.406.dylib","libopencv_core.dylib",
                                "libopencv_dnn.4.6.0.dylib","libopencv_dnn.406.dylib","libopencv_dnn.dylib",
                                "libopencv_features2d.4.6.0.dylib","libopencv_features2d.406.dylib","libopencv_features2d.dylib",
                                "libopencv_flann.4.6.0.dylib","libopencv_flann.406.dylib","libopencv_flann.dylib",
                                "libopencv_gapi.4.6.0.dylib","libopencv_gapi.406.dylib","libopencv_gapi.dylib",
                                "libopencv_highgui.4.6.0.dylib","libopencv_highgui.406.dylib","libopencv_highgui.dylib",
                                "libopencv_imgcodecs.4.6.0.dylib","libopencv_imgcodecs.406.dylib","libopencv_imgcodecs.dylib",
                                "libopencv_imgproc.4.6.0.dylib","libopencv_imgproc.406.dylib","libopencv_imgproc.dylib",
                                "libopencv_ml.4.6.0.dylib","libopencv_ml.406.dylib","libopencv_ml.dylib",
                                "libopencv_objdetect.4.6.0.dylib","libopencv_objdetect.406.dylib","libopencv_objdetect.dylib",
                                "libopencv_photo.4.6.0.dylib","libopencv_photo.406.dylib","libopencv_photo.dylib",
                                "libopencv_stitching.4.6.0.dylib","libopencv_stitching.406.dylib","libopencv_stitching.dylib",
                                "libopencv_video.4.6.0.dylib","libopencv_video.406.dylib","libopencv_video.dylib",
                                "libopencv_videoio.4.6.0.dylib","libopencv_videoio.406.dylib","libopencv_videoio.dylib",],
        "@bazel_tools//src/conditions:linux_x86_64": ["libopencv_calib3d.so.4.6.0","libopencv_calib3d.so.406","libopencv_calib3d.so",
                                "libopencv_core.so.4.6.0","libopencv_core.so.406","libopencv_core.so",
                                "libopencv_dnn.so.4.6.0","libopencv_dnn.so.406","libopencv_dnn.so",
                                "libopencv_features2d.so.4.6.0","libopencv_features2d.so.406","libopencv_features2d.so",
                                "libopencv_flann.so.4.6.0","libopencv_flann.so.406","libopencv_flann.so",
                                "libopencv_gapi.so.4.6.0","libopencv_gapi.so.406","libopencv_gapi.so",
                                "libopencv_highgui.so.4.6.0","libopencv_highgui.so.406","libopencv_highgui.so",
                                "libopencv_imgcodecs.so.4.6.0","libopencv_imgcodecs.so.406","libopencv_imgcodecs.so",
                                "libopencv_imgproc.so.4.6.0","libopencv_imgproc.so.406","libopencv_imgproc.so",
                                "libopencv_ml.so.4.6.0","libopencv_ml.so.406","libopencv_ml.so",
                                "libopencv_objdetect.so.4.6.0","libopencv_objdetect.so.406","libopencv_objdetect.so",
                                "libopencv_photo.so.4.6.0","libopencv_photo.so.406","libopencv_photo.so",
                                "libopencv_stitching.so.4.6.0","libopencv_stitching.so.406","libopencv_stitching.so",
                                "libopencv_video.so.4.6.0","libopencv_video.so.406","libopencv_video.so",
                                "libopencv_videoio.so.4.6.0","libopencv_videoio.so.406","libopencv_videoio.so",]}),
        visibility = ["//visibility:public"],
)