load("@rules_foreign_cc//foreign_cc:cmake.bzl", "cmake")

filegroup(
    name = "all_srcs",
    srcs = glob(["**"]),
)

cmake(
    name = "opencv",
    lib_source = "//:all_srcs",
    cache_entries = {
        "BUILD_PERF_TESTS": "OFF",
        "BUILD_TESTS": "OFF",
        "BUILD_opencv_java_bindings_generator": "OFF",
        "BUILD_opencv_js": "OFF",
        "BUILD_opencv_js_bindings_generator": "OFF",
        "BUILD_opencv_python_bindings_generator": "OFF",
        "BUILD_opencv_python_tests": "OFF",
        "BUILD_OPENJPEG": "ON",
        "WITH_GTK": "ON",
    },
    generate_args = ["-GNinja"],
    tags = ["requires-network"],
    out_include_dir = "include/opencv4",
    out_shared_libs = [
        "libopencv_calib3d.so",
        "libopencv_calib3d.so.4.6.0",
        "libopencv_calib3d.so.406",
        "libopencv_core.so",
        "libopencv_core.so.4.6.0",
        "libopencv_core.so.406",
        "libopencv_dnn.so",
        "libopencv_dnn.so.4.6.0",
        "libopencv_dnn.so.406",
        "libopencv_features2d.so",
        "libopencv_features2d.so.4.6.0",
        "libopencv_features2d.so.406",
        "libopencv_flann.so",
        "libopencv_flann.so.4.6.0",
        "libopencv_flann.so.406",
        "libopencv_gapi.so",
        "libopencv_gapi.so.4.6.0",
        "libopencv_gapi.so.406",
        "libopencv_highgui.so",
        "libopencv_highgui.so.4.6.0",
        "libopencv_highgui.so.406",
        "libopencv_imgcodecs.so",
        "libopencv_imgcodecs.so.4.6.0",
        "libopencv_imgcodecs.so.406",
        "libopencv_imgproc.so",
        "libopencv_imgproc.so.4.6.0",
        "libopencv_imgproc.so.406",
        "libopencv_ml.so",
        "libopencv_ml.so.4.6.0",
        "libopencv_ml.so.406",
        "libopencv_objdetect.so",
        "libopencv_objdetect.so.4.6.0",
        "libopencv_objdetect.so.406",
        "libopencv_photo.so",
        "libopencv_photo.so.4.6.0",
        "libopencv_photo.so.406",
        "libopencv_stitching.so",
        "libopencv_stitching.so.4.6.0",
        "libopencv_stitching.so.406",
        "libopencv_video.so",
        "libopencv_video.so.4.6.0",
        "libopencv_video.so.406",
        "libopencv_videoio.so",
        "libopencv_videoio.so.4.6.0",
        "libopencv_videoio.so.406",
    ],
    visibility = ["//visibility:public"],
)
